<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vooters Break - Admin</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyBe3ftCo_LjKuKJinDWwYEH39lM8-RrN7I",
            authDomain: "vooter-s-break-1cc7f.firebaseapp.com",
            databaseURL: "https://vooter-s-break-1cc7f-default-rtdb.firebaseio.com",
            projectId: "vooter-s-break-1cc7f",
            storageBucket: "vooter-s-break-1cc7f.firebasestorage.app",
            messagingSenderId: "110233483951",
            appId: "1:110233483951:web:87372560112c986c1b725a"
        };

        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();

        const ADMIN_PASSWORD = 'vooters2024';

        function VootersBreakAdmin() {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            const [password, setPassword] = useState('');
            const [breaks, setBreaks] = useState([]);
            const [pendingReservations, setPendingReservations] = useState([]);
            const [activeTab, setActiveTab] = useState('breaks');
            const [showAddBreak, setShowAddBreak] = useState(false);
            const [editingBreak, setEditingBreak] = useState(null);
            const [showMergeModal, setShowMergeModal] = useState(null);
            const [mergeSelection, setMergeSelection] = useState([]);
            const [newMergedName, setNewMergedName] = useState('');
            const [showManualSpots, setShowManualSpots] = useState(null);
            
            const [newBreak, setNewBreak] = useState({
                title: '',
                sport: 'hockey',
                product: '',
                boxCount: 1,
                pricePerSpot: '',
                totalSpots: 32,
                date: '',
                time: '',
                status: 'upcoming',
                description: ''
            });

            const [manualSpotForm, setManualSpotForm] = useState({
                name: '',
                spots: '',
                paymentStatus: 'deferred'
            });

            useEffect(() => {
                if (isAuthenticated) {
                    const breaksRef = database.ref('breaks');
                    const reservationsRef = database.ref('reservations');
                    
                    breaksRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const breaksArray = Object.keys(data).map(key => ({
                                ...data[key],
                                id: key
                            }));
                            setBreaks(breaksArray);
                        }
                    });

                    reservationsRef.on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            const reservationsArray = Object.keys(data).map(key => ({
                                ...data[key],
                                id: key
                            })).filter(r => r.status === 'pending');
                            setPendingReservations(reservationsArray);
                        }
                    });

                    return () => {
                        breaksRef.off();
                        reservationsRef.off();
                    };
                }
            }, [isAuthenticated]);

            const handleLogin = () => {
                if (password === ADMIN_PASSWORD) {
                    setIsAuthenticated(true);
                    setPassword('');
                } else {
                    alert('Mot de passe incorrect');
                }
            };

            const addBreak = () => {
                if (!newBreak.title || !newBreak.product || !newBreak.pricePerSpot) {
                    alert('Veuillez remplir tous les champs requis');
                    return;
                }

                const breakToAdd = {
                    ...newBreak,
                    createdAt: new Date().toISOString(),
                    teams: [],
                    participants: {},
                    randomizedTeams: [],
                    pendingSpots: {}
                };

                database.ref('breaks').push(breakToAdd).then(() => {
                    setNewBreak({
                        title: '',
                        sport: 'hockey',
                        product: '',
                        boxCount: 1,
                        pricePerSpot: '',
                        totalSpots: 32,
                        date: '',
                        time: '',
                        status: 'upcoming',
                        description: ''
                    });
                    setShowAddBreak(false);
                    alert('Break crÃ©Ã© avec succÃ¨s!');
                });
            };

            const startEditBreak = (breakItem) => {
                setEditingBreak({
                    id: breakItem.id,
                    title: breakItem.title,
                    sport: breakItem.sport,
                    product: breakItem.product,
                    boxCount: breakItem.boxCount,
                    pricePerSpot: breakItem.pricePerSpot,
                    totalSpots: breakItem.totalSpots,
                    date: breakItem.date || '',
                    time: breakItem.time || '',
                    description: breakItem.description || ''
                });
            };

            const saveEditBreak = () => {
                if (!editingBreak.title || !editingBreak.product || !editingBreak.pricePerSpot) {
                    alert('Veuillez remplir tous les champs requis');
                    return;
                }

                database.ref('breaks/' + editingBreak.id).update({
                    title: editingBreak.title,
                    sport: editingBreak.sport,
                    product: editingBreak.product,
                    boxCount: editingBreak.boxCount,
                    pricePerSpot: editingBreak.pricePerSpot,
                    totalSpots: editingBreak.totalSpots,
                    date: editingBreak.date,
                    time: editingBreak.time,
                    description: editingBreak.description
                }).then(() => {
                    setEditingBreak(null);
                    alert('Break modifiÃ© avec succÃ¨s!');
                });
            };

            const addManualSpots = () => {
                if (!manualSpotForm.name || !manualSpotForm.spots) {
                    alert('Veuillez remplir le nom et les spots');
                    return;
                }

                const spotNumbers = manualSpotForm.spots.split(',').map(s => parseInt(s.trim())).filter(s => !isNaN(s));
                const breakRef = database.ref('breaks/' + showManualSpots.id);
                
                breakRef.once('value', (snapshot) => {
                    const breakData = snapshot.val();
                    const participants = breakData.participants || {};
                    
                    const newParticipantKey = database.ref().child('participants').push().key;
                    participants[newParticipantKey] = {
                        name: manualSpotForm.name,
                        spots: spotNumbers,
                        paymentStatus: manualSpotForm.paymentStatus,
                        addedManually: true,
                        timestamp: new Date().toISOString()
                    };

                    breakRef.update({ participants: participants }).then(() => {
                        setManualSpotForm({ name: '', spots: '', paymentStatus: 'deferred' });
                        setShowManualSpots(null);
                        alert('Spots attribuÃ©s avec succÃ¨s!');
                    });
                });
            };

            const updatePaymentStatus = (breakId, participantId, newStatus) => {
                database.ref(`breaks/${breakId}/participants/${participantId}`).update({
                    paymentStatus: newStatus
                });
            };

            const deleteBreak = (id) => {
                if (window.confirm('Voulez-vous vraiment supprimer ce break?')) {
                    database.ref('breaks/' + id).remove();
                }
            };

            const updateBreakStatus = (id, newStatus) => {
                database.ref('breaks/' + id).update({ status: newStatus });
            };

            const generateAIDescription = (sport, product) => {
                const descriptions = {
                    hockey: [
                        `Break de ${product}! Excellentes chances de hits avec des rookies et autographes possibles!`,
                        `ðŸ”¥ Break HOT! ${product} - Recherchez vos joueurs prÃ©fÃ©rÃ©s et les cartes parallÃ¨les rares!`
                    ],
                    baseball: [`âš¾ Break MLB! ${product} - Chassez les rookies et autographes!`],
                    basketball: [`ðŸ€ Break NBA! ${product} - Rookies stars et cartes numÃ©rotÃ©es!`],
                    football: [`ðŸˆ Break NFL! ${product} - Rookies et autographes!`]
                };

                const sportDescriptions = descriptions[sport] || descriptions.hockey;
                return sportDescriptions[Math.floor(Math.random() * sportDescriptions.length)];
            };

            const addAIDescription = (breakId, breakItem) => {
                const aiDescription = generateAIDescription(breakItem.sport, breakItem.product);
                database.ref('breaks/' + breakId).update({ description: aiDescription });
                alert('Description IA gÃ©nÃ©rÃ©e!');
            };

            const approveReservation = (reservation) => {
                const breakRef = database.ref('breaks/' + reservation.breakId);
                
                breakRef.once('value', (snapshot) => {
                    const breakData = snapshot.val();
                    const participants = breakData.participants || {};
                    
                    const newParticipantKey = database.ref().child('participants').push().key;
                    participants[newParticipantKey] = {
                        name: reservation.name,
                        email: reservation.email,
                        phone: reservation.phone,
                        spots: reservation.spots,
                        paymentStatus: 'paid',
                        timestamp: new Date().toISOString()
                    };

                    // CORRECTION: Retirer les spots de pendingSpots en utilisant la clÃ©
                    const updates = {
                        participants: participants
                    };
                    
                    if (reservation.pendingKey) {
                        updates[`pendingSpots/${reservation.pendingKey}`] = null;
                    }

                    breakRef.update(updates);
                    database.ref('reservations/' + reservation.id).update({ status: 'approved' });
                    
                    alert('RÃ©servation approuvÃ©e!');
                });
            };

            const rejectReservation = (reservation) => {
                if (window.confirm('Voulez-vous vraiment refuser cette rÃ©servation?')) {
                    // CORRECTION: DÃ©bloquer les spots en utilisant la clÃ© pendingKey
                    if (reservation.pendingKey) {
                        database.ref(`breaks/${reservation.breakId}/pendingSpots/${reservation.pendingKey}`).remove();
                    }
                    
                    database.ref('reservations/' + reservation.id).update({ status: 'rejected' });
                    alert('RÃ©servation refusÃ©e et spots dÃ©bloquÃ©s');
                }
            };

            const mergeParticipants = (breakId) => {
                if (mergeSelection.length < 2) {
                    alert('SÃ©lectionnez au moins 2 participants Ã  fusionner');
                    return;
                }
                
                if (!newMergedName) {
                    alert('Entrez le nom final');
                    return;
                }

                const breakRef = database.ref('breaks/' + breakId);
                breakRef.once('value', (snapshot) => {
                    const breakData = snapshot.val();
                    const participants = breakData.participants || {};
                    
                    const mergedSpots = [];
                    let mergedEmail = '';
                    let mergedPhone = '';
                    let mergedPaymentStatus = 'paid';
                    
                    mergeSelection.forEach(key => {
                        const p = participants[key];
                        mergedSpots.push(...p.spots);
                        if (!mergedEmail && p.email) mergedEmail = p.email;
                        if (!mergedPhone && p.phone) mergedPhone = p.phone;
                        if (p.paymentStatus === 'deferred') mergedPaymentStatus = 'deferred';
                        delete participants[key];
                    });

                    const newKey = database.ref().child('participants').push().key;
                    participants[newKey] = {
                        name: newMergedName,
                        email: mergedEmail,
                        phone: mergedPhone,
                        spots: mergedSpots.sort((a, b) => a - b),
                        paymentStatus: mergedPaymentStatus,
                        merged: true,
                        timestamp: new Date().toISOString()
                    };

                    breakRef.update({ participants: participants }).then(() => {
                        setShowMergeModal(null);
                        setMergeSelection([]);
                        setNewMergedName('');
                        alert('Participants fusionnÃ©s!');
                    });
                });
            };

            const generateAnnouncementText = (breakItem) => {
                const soldSpots = breakItem.participants ? Object.keys(breakItem.participants).reduce((sum, key) => {
                    return sum + breakItem.participants[key].spots.length;
                }, 0) : 0;
                const availableSpots = breakItem.totalSpots - soldSpots;
                
                return `ðŸ’ NOUVEAU BREAK! ðŸ’\n\n${breakItem.title}\n\nðŸ“¦ Produit: ${breakItem.product}\nðŸ“Š BoÃ®tes: ${breakItem.boxCount}\nðŸ’° Prix: ${breakItem.pricePerSpot}$ par spot\nðŸ‘¥ Spots disponibles: ${availableSpots}/${breakItem.totalSpots}\nðŸ“… Date: ${breakItem.date || 'Ã€ dÃ©terminer'}\nâ° Heure: ${breakItem.time || 'Ã€ dÃ©terminer'}\n\n${breakItem.description || ''}\n\nðŸ”¥ RÃ©servez: https://vootersbreak.vercel.app\nðŸ’³ Paiement: Interac Ã  vootersbreak@gmail.com\n\n#${breakItem.sport} #cardsbreak`;
            };

            const copyAnnouncement = (breakItem) => {
                const text = generateAnnouncementText(breakItem);
                navigator.clipboard.writeText(text);
                alert('Annonce copiÃ©e!');
            };

            const calculateDebts = () => {
                const debts = {};
                breaks.forEach(breakItem => {
                    if (breakItem.participants) {
                        Object.entries(breakItem.participants).forEach(([key, participant]) => {
                            if (participant.paymentStatus === 'deferred') {
                                const amount = participant.spots.length * parseFloat(breakItem.pricePerSpot);
                                if (!debts[participant.name]) {
                                    debts[participant.name] = { total: 0, details: [] };
                                }
                                debts[participant.name].total += amount;
                                debts[participant.name].details.push({
                                    break: breakItem.title,
                                    spots: participant.spots.length,
                                    amount: amount
                                });
                            }
                        });
                    }
                });
                return debts;
            };

            const stats = {
                total: breaks.length,
                upcoming: breaks.filter(b => b.status === 'upcoming').length,
                live: breaks.filter(b => b.status === 'live').length,
                completed: breaks.filter(b => b.status === 'completed').length,
                pending: pendingReservations.length
            };

            const totalDebts = Object.values(calculateDebts()).reduce((sum, debt) => sum + debt.total, 0);

            if (!isAuthenticated) {
                return React.createElement('div', {
                    className: "min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 flex items-center justify-center p-4"
                },
                    React.createElement('div', { className: "bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full" },
                        React.createElement('div', { className: "text-center mb-8" },
                            React.createElement('div', { className: "text-6xl mb-4" }, "ðŸ”’"),
                            React.createElement('h1', { className: "text-3xl font-bold text-gray-800 mb-2" }, "Admin Login"),
                            React.createElement('p', { className: "text-gray-600" }, "Vooters Break")
                        ),
                        React.createElement('div', { className: "space-y-4" },
                            React.createElement('input', {
                                type: "password",
                                value: password,
                                onChange: (e) => setPassword(e.target.value),
                                onKeyPress: (e) => e.key === 'Enter' && handleLogin(),
                                placeholder: "Mot de passe",
                                className: "w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                            }),
                            React.createElement('button', {
                                onClick: handleLogin,
                                className: "w-full bg-gradient-to-r from-red-600 to-red-500 text-white py-3 rounded-lg font-semibold"
                            }, "Se connecter")
                        )
                    )
                );
            }

            return React.createElement('div', { className: "min-h-screen bg-gradient-to-br from-gray-50 to-gray-100" },
                React.createElement('div', { className: "max-w-7xl mx-auto p-4 sm:p-6" },
                    React.createElement('div', { className: "flex items-center justify-between mb-8 pt-6" },
                        React.createElement('div', {},
                            React.createElement('h1', { className: "text-4xl font-bold text-gray-800 mb-2" }, "Admin - Vooters Break")
                        ),
                        React.createElement('div', { className: "flex gap-3" },
                            React.createElement('button', {
                                onClick: () => setShowAddBreak(!showAddBreak),
                                className: "bg-red-600 text-white px-6 py-3 rounded-lg font-semibold"
                            }, "+ Nouveau Break"),
                            React.createElement('button', {
                                onClick: () => setIsAuthenticated(false),
                                className: "bg-gray-600 text-white px-4 py-3 rounded-lg font-semibold"
                            }, "DÃ©connexion")
                        )
                    ),

                    React.createElement('div', { className: "grid grid-cols-2 sm:grid-cols-6 gap-4 mb-6" },
                        [
                            { label: "Total", value: stats.total },
                            { label: "Ã€ venir", value: stats.upcoming },
                            { label: "Live", value: stats.live },
                            { label: "ComplÃ©tÃ©s", value: stats.completed },
                            { label: "RÃ©servations", value: stats.pending, hasNotif: stats.pending > 0 },
                            { label: "Dettes", value: totalDebts.toFixed(0) + "$", color: "text-orange-600" }
                        ].map((stat, idx) =>
                            React.createElement('div', {
                                key: idx,
                                className: "bg-white rounded-xl shadow-md p-4 relative"
                            },
                                React.createElement('p', { className: "text-sm text-gray-600 mb-2" }, stat.label),
                                React.createElement('p', { 
                                    className: `text-2xl font-bold ${stat.color || ''}`
                                }, stat.value),
                                stat.hasNotif && React.createElement('span', {
                                    className: "absolute top-2 right-2 w-3 h-3 bg-red-500 rounded-full animate-pulse"
                                })
                            )
                        )
                    ),

                    React.createElement('div', { className: "flex gap-2 mb-6 bg-white rounded-lg p-1 shadow-sm flex-wrap" },
                        React.createElement('button', {
                            onClick: () => setActiveTab('breaks'),
                            className: `flex-1 py-3 rounded-md font-medium ${activeTab === 'breaks' ? 'bg-red-600 text-white' : 'text-gray-600'}`
                        }, "ðŸ“¦ Breaks"),
                        React.createElement('button', {
                            onClick: () => setActiveTab('reservations'),
                            className: `flex-1 py-3 rounded-md font-medium relative ${activeTab === 'reservations' ? 'bg-red-600 text-white' : 'text-gray-600'}`
                        },
                            `ðŸ”” RÃ©servations (${stats.pending})`,
                            stats.pending > 0 && React.createElement('span', {
                                className: "absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full animate-pulse"
                            })
                        ),
                        React.createElement('button', {
                            onClick: () => setActiveTab('debts'),
                            className: `flex-1 py-3 rounded-md font-medium ${activeTab === 'debts' ? 'bg-red-600 text-white' : 'text-gray-600'}`
                        }, "ðŸ’° Dettes")
                    ),

                    (showAddBreak || editingBreak) && React.createElement('div', { className: "bg-white rounded-xl shadow-lg p-6 mb-6" },
                        React.createElement('h2', { className: "text-2xl font-bold mb-6" }, editingBreak ? "Modifier le break" : "CrÃ©er un nouveau break"),
                        React.createElement('div', { className: "grid sm:grid-cols-2 gap-4 mb-4" },
                            React.createElement('input', {
                                type: "text",
                                value: editingBreak ? editingBreak.title : newBreak.title,
                                onChange: (e) => editingBreak ? 
                                    setEditingBreak({...editingBreak, title: e.target.value}) :
                                    setNewBreak({...newBreak, title: e.target.value}),
                                placeholder: "Titre *",
                                className: "px-4 py-2 border rounded-lg"
                            }),
                            React.createElement('select', {
                                value: editingBreak ? editingBreak.sport : newBreak.sport,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, sport: e.target.value}) :
                                    setNewBreak({...newBreak, sport: e.target.value}),
                                className: "px-4 py-2 border rounded-lg"
                            },
                                ['hockey', 'baseball', 'basketball', 'football'].map(sport =>
                                    React.createElement('option', { key: sport, value: sport }, sport.charAt(0).toUpperCase() + sport.slice(1))
                                )
                            ),
                            React.createElement('input', {
                                type: "text",
                                value: editingBreak ? editingBreak.product : newBreak.product,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, product: e.target.value}) :
                                    setNewBreak({...newBreak, product: e.target.value}),
                                placeholder: "Produit *",
                                className: "px-4 py-2 border rounded-lg"
                            }),
                            React.createElement('input', {
                                type: "number",
                                value: editingBreak ? editingBreak.boxCount : newBreak.boxCount,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, boxCount: parseInt(e.target.value) || 1}) :
                                    setNewBreak({...newBreak, boxCount: parseInt(e.target.value) || 1}),
                                placeholder: "BoÃ®tes",
                                className: "px-4 py-2 border rounded-lg"
                            }),
                            React.createElement('input', {
                                type: "number",
                                value: editingBreak ? editingBreak.pricePerSpot : newBreak.pricePerSpot,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, pricePerSpot: e.target.value}) :
                                    setNewBreak({...newBreak, pricePerSpot: e.target.value}),
                                placeholder: "Prix/spot *",
                                className: "px-4 py-2 border rounded-lg"
                            }),
                            React.createElement('input', {
                                type: "number",
                                value: editingBreak ? editingBreak.totalSpots : newBreak.totalSpots,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, totalSpots: parseInt(e.target.value) || 32}) :
                                    setNewBreak({...newBreak, totalSpots: parseInt(e.target.value) || 32}),
                                placeholder: "Spots",
                                className: "px-4 py-2 border rounded-lg"
                            }),
                            React.createElement('input', {
                                type: "date",
                                value: editingBreak ? editingBreak.date : newBreak.date,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, date: e.target.value}) :
                                    setNewBreak({...newBreak, date: e.target.value}),
                                className: "px-4 py-2 border rounded-lg"
                            }),
                            React.createElement('input', {
                                type: "time",
                                value: editingBreak ? editingBreak.time : newBreak.time,
                                onChange: (e) => editingBreak ?
                                    setEditingBreak({...editingBreak, time: e.target.value}) :
                                    setNewBreak({...newBreak, time: e.target.value}),
                                className: "px-4 py-2 border rounded-lg"
                            })
                        ),
                        React.createElement('textarea', {
                            value: editingBreak ? editingBreak.description : newBreak.description,
                            onChange: (e) => editingBreak ?
                                setEditingBreak({...editingBreak, description: e.target.value}) :
                                setNewBreak({...newBreak, description: e.target.value}),
                            placeholder: "Description",
                            rows: "3",
                            className: "w-full px-4 py-2 border rounded-lg mb-4"
                        }),
                        React.createElement('div', { className: "flex gap-3" },
                            React.createElement('button', {
                                onClick: editingBreak ? saveEditBreak : addBreak,
                                className: "flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold"
                            }, editingBreak ? "ðŸ’¾ Sauvegarder" : "âœ… CrÃ©er"),
                            React.createElement('button', {
                                onClick: () => {
                                    setShowAddBreak(false);
                                    setEditingBreak(null);
                                },
                                className: "px-6 py-3 border-2 rounded-lg font-semibold"
                            }, "Annuler")
                        )
                    ),

                    activeTab === 'breaks' && React.createElement('div', { className: "space-y-4" },
                        breaks.length === 0 ?
                            React.createElement('div', { className: "bg-white rounded-xl shadow-md p-12 text-center" },
                                React.createElement('p', { className: "text-gray-500 text-lg" }, "Aucun break")
                            )
                        :
                            breaks.map(breakItem => {
                                const participants = breakItem.participants ? Object.entries(breakItem.participants) : [];
                                const deferredCount = participants.filter(([k, p]) => p.paymentStatus === 'deferred').length;
                                
                                return React.createElement('div', {
                                    key: breakItem.id,
                                    className: "bg-white rounded-xl shadow-md p-6"
                                },
                                    React.createElement('div', { className: "flex justify-between mb-4" },
                                        React.createElement('div', {},
                                            React.createElement('h3', { className: "text-xl font-bold" }, breakItem.title),
                                            React.createElement('p', { className: "text-gray-600" }, breakItem.product),
                                            participants.length > 0 && React.createElement('p', { className: "text-sm text-gray-500 mt-1" },
                                                `${participants.length} participant(s)` +
                                                (deferredCount > 0 ? ` - ${deferredCount} paiement(s) reportÃ©(s)` : '')
                                            )
                                        ),
                                        React.createElement('button', {
                                            onClick: () => deleteBreak(breakItem.id),
                                            className: "text-red-600"
                                        }, "ðŸ—‘ï¸")
                                    ),
                                    React.createElement('div', { className: "flex flex-wrap gap-2 mb-4" },
                                        React.createElement('button', {
                                            onClick: () => startEditBreak(breakItem),
                                            className: "px-4 py-2 bg-blue-600 text-white rounded-lg text-sm"
                                        }, "âœï¸ Modifier"),
                                        React.createElement('button', {
                                            onClick: () => copyAnnouncement(breakItem),
                                            className: "px-4 py-2 bg-green-600 text-white rounded-lg text-sm"
                                        }, "ðŸ“¢ Annonce"),
                                        React.createElement('button', {
                                            onClick: () => addAIDescription(breakItem.id, breakItem),
                                            className: "px-4 py-2 bg-purple-600 text-white rounded-lg text-sm"
                                        }, "âœ¨ IA"),
                                        React.createElement('button', {
                                            onClick: () => setShowManualSpots(breakItem),
                                            className: "px-4 py-2 bg-orange-600 text-white rounded-lg text-sm"
                                        }, "ðŸ‘¤ Donner Spots"),
                                        participants.length >= 2 && React.createElement('button', {
                                            onClick: () => {
                                                setShowMergeModal(breakItem);
                                                setMergeSelection([]);
                                                setNewMergedName('');
                                            },
                                            className: "px-4 py-2 bg-yellow-600 text-white rounded-lg text-sm"
                                        }, "ðŸ”— Fusionner"),
                                        React.createElement('button', {
                                            onClick: () => updateBreakStatus(breakItem.id, 'live'),
                                            className: "px-4 py-2 bg-red-600 text-white rounded-lg text-sm"
                                        }, "ðŸ”´ Live"),
                                        React.createElement('button', {
                                            onClick: () => updateBreakStatus(breakItem.id, 'completed'),
                                            className: "px-4 py-2 bg-gray-600 text-white rounded-lg text-sm"
                                        }, "âœ… Terminer")
                                    ),
                                    
                                    participants.length > 0 && React.createElement('div', { className: "mt-4 border-t pt-4" },
                                        React.createElement('h4', { className: "font-semibold mb-2" }, "Participants:"),
                                        React.createElement('div', { className: "space-y-2" },
                                            participants.map(([key, participant]) =>
                                                React.createElement('div', {
                                                    key: key,
                                                    className: "flex items-center justify-between p-2 bg-gray-50 rounded"
                                                },
                                                    React.createElement('div', {},
                                                        React.createElement('span', { className: "font-medium" }, participant.name),
                                                        React.createElement('span', { className: "text-sm text-gray-600 ml-2" },
                                                            `Spots: ${participant.spots.join(', ')}`
                                                        )
                                                    ),
                                                    React.createElement('select', {
                                                        value: participant.paymentStatus || 'paid',
                                                        onChange: (e) => updatePaymentStatus(breakItem.id, key, e.target.value),
                                                        className: `px-2 py-1 rounded text-sm ${
                                                            participant.paymentStatus === 'paid' ? 'bg-green-100 text-green-700' :
                                                            participant.paymentStatus === 'deferred' ? 'bg-orange-100 text-orange-700' :
                                                            'bg-gray-100 text-gray-700'
                                                        }`
                                                    },
                                                        React.createElement('option', { value: 'paid' }, 'âœ… PayÃ©'),
                                                        React.createElement('option', { value: 'deferred' }, 'â³ ReportÃ©'),
                                                        React.createElement('option', { value: 'pending' }, 'â±ï¸ En attente')
                                                    )
                                                )
                                            )
                                        )
                                    )
                                );
                            })
                    ),

                    activeTab === 'reservations' && React.createElement('div', { className: "space-y-4" },
                        pendingReservations.length === 0 ?
                            React.createElement('div', { className: "bg-white rounded-xl shadow-md p-12 text-center" },
                                React.createElement('p', { className: "text-gray-500 text-lg" }, "Aucune rÃ©servation")
                            )
                        :
                            pendingReservations.map(reservation => React.createElement('div', {
                                key: reservation.id,
                                className: "bg-white rounded-xl shadow-md p-6"
                            },
                                React.createElement('h3', { className: "text-xl font-bold mb-2" }, reservation.name),
                                React.createElement('p', { className: "text-gray-600 mb-1" }, reservation.breakTitle),
                                React.createElement('p', { className: "text-sm text-gray-500 mb-2" }, `Email: ${reservation.email}`),
                                React.createElement('p', { className: "font-semibold text-green-600 mb-4" }, 
                                    `${reservation.totalAmount}$ - Spots: ${reservation.spots.join(', ')}`
                                ),
                                React.createElement('div', { className: "flex gap-3" },
                                    React.createElement('button', {
                                        onClick: () => approveReservation(reservation),
                                        className: "flex-1 bg-green-600 text-white py-3 rounded-lg font-semibold"
                                    }, "âœ… Approuver"),
                                    React.createElement('button', {
                                        onClick: () => rejectReservation(reservation),
                                        className: "flex-1 bg-red-600 text-white py-3 rounded-lg font-semibold"
                                    }, "âŒ Refuser")
                                )
                            ))
                    ),

                    activeTab === 'debts' && React.createElement('div', { className: "space-y-4" },
                        Object.keys(calculateDebts()).length === 0 ?
                            React.createElement('div', { className: "bg-white rounded-xl shadow-md p-12 text-center" },
                                React.createElement('div', { className: "text-6xl mb-4" }, "ðŸŽ‰"),
                                React.createElement('p', { className: "text-gray-500 text-lg" }, "Aucune dette!"),
                                React.createElement('p', { className: "text-gray-400 text-sm mt-2" }, "Tous les paiements sont Ã  jour")
                            )
                        :
                            Object.entries(calculateDebts()).map(([name, debt]) =>
                                React.createElement('div', {
                                    key: name,
                                    className: "bg-white rounded-xl shadow-md p-6"
                                },
                                    React.createElement('div', { className: "flex items-center justify-between mb-4" },
                                        React.createElement('h3', { className: "text-xl font-bold" }, name),
                                        React.createElement('span', { className: "text-2xl font-bold text-orange-600" }, 
                                            debt.total.toFixed(2) + "$"
                                        )
                                    ),
                                    React.createElement('div', { className: "space-y-2" },
                                        debt.details.map((detail, idx) =>
                                            React.createElement('div', {
                                                key: idx,
                                                className: "flex items-center justify-between p-3 bg-orange-50 rounded-lg"
                                            },
                                                React.createElement('div', {},
                                                    React.createElement('p', { className: "font-medium text-sm" }, detail.break),
                                                    React.createElement('p', { className: "text-xs text-gray-600" }, 
                                                        `${detail.spots} spot(s)`
                                                    )
                                                ),
                                                React.createElement('span', { className: "font-bold text-orange-600" }, 
                                                    detail.amount.toFixed(2) + "$"
                                                )
                                            )
                                        )
                                    )
                                )
                            )
                    ),

                    showManualSpots && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                    },
                        React.createElement('div', { className: "bg-white rounded-xl shadow-2xl max-w-md w-full p-6" },
                            React.createElement('h2', { className: "text-2xl font-bold mb-4" }, 
                                "Attribuer des spots - " + showManualSpots.title
                            ),
                            React.createElement('div', { className: "space-y-4 mb-6" },
                                React.createElement('input', {
                                    type: "text",
                                    value: manualSpotForm.name,
                                    onChange: (e) => setManualSpotForm({...manualSpotForm, name: e.target.value}),
                                    placeholder: "Nom du participant",
                                    className: "w-full px-4 py-2 border rounded-lg"
                                }),
                                React.createElement('input', {
                                    type: "text",
                                    value: manualSpotForm.spots,
                                    onChange: (e) => setManualSpotForm({...manualSpotForm, spots: e.target.value}),
                                    placeholder: "Spots (ex: 1, 5, 12)",
                                    className: "w-full px-4 py-2 border rounded-lg"
                                }),
                                React.createElement('select', {
                                    value: manualSpotForm.paymentStatus,
                                    onChange: (e) => setManualSpotForm({...manualSpotForm, paymentStatus: e.target.value}),
                                    className: "w-full px-4 py-2 border rounded-lg"
                                },
                                    React.createElement('option', { value: 'deferred' }, 'â³ Paiement reportÃ©'),
                                    React.createElement('option', { value: 'paid' }, 'âœ… DÃ©jÃ  payÃ©'),
                                    React.createElement('option', { value: 'pending' }, 'â±ï¸ En attente')
                                )
                            ),
                            React.createElement('div', { className: "flex gap-3" },
                                React.createElement('button', {
                                    onClick: addManualSpots,
                                    className: "flex-1 bg-orange-600 text-white py-3 rounded-lg font-semibold"
                                }, "âœ… Attribuer"),
                                React.createElement('button', {
                                    onClick: () => {
                                        setShowManualSpots(null);
                                        setManualSpotForm({ name: '', spots: '', paymentStatus: 'deferred' });
                                    },
                                    className: "px-6 py-3 border-2 rounded-lg font-semibold"
                                }, "Annuler")
                            )
                        )
                    ),

                    showMergeModal && React.createElement('div', {
                        className: "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
                    },
                        React.createElement('div', { className: "bg-white rounded-xl shadow-2xl max-w-2xl w-full p-6 max-h-[90vh] overflow-y-auto" },
                            React.createElement('h2', { className: "text-2xl font-bold mb-4" }, 
                                "Fusionner des participants - " + showMergeModal.title
                            ),
                            React.createElement('div', { className: "mb-6" },
                                React.createElement('p', { className: "text-gray-600 mb-4" }, "SÃ©lectionnez les participants Ã  fusionner:"),
                                React.createElement('div', { className: "space-y-2" },
                                    showMergeModal.participants && Object.entries(showMergeModal.participants).map(([key, participant]) =>
                                        React.createElement('label', {
                                            key: key,
                                            className: "flex items-center p-3 bg-gray-50 rounded-lg cursor-pointer hover:bg-gray-100"
                                        },
                                            React.createElement('input', {
                                                type: "checkbox",
                                                checked: mergeSelection.includes(key),
                                                onChange: (e) => {
                                                    if (e.target.checked) {
                                                        setMergeSelection([...mergeSelection, key]);
                                                    } else {
                                                        setMergeSelection(mergeSelection.filter(k => k !== key));
                                                    }
                                                },
                                                className: "mr-3"
                                            }),
                                            React.createElement('div', {},
                                                React.createElement('p', { className: "font-medium" }, participant.name),
                                                React.createElement('p', { className: "text-sm text-gray-600" }, 
                                                    `Spots: ${participant.spots.join(', ')}`
                                                )
                                            )
                                        )
                                    )
                                )
                            ),
                            mergeSelection.length >= 2 && React.createElement('div', { className: "mb-6" },
                                React.createElement('input', {
                                    type: "text",
                                    value: newMergedName,
                                    onChange: (e) => setNewMergedName(e.target.value),
                                    placeholder: "Nom final du participant fusionnÃ©",
                                    className: "w-full px-4 py-2 border rounded-lg"
                                })
                            ),
                            React.createElement('div', { className: "flex gap-3" },
                                React.createElement('button', {
                                    onClick: () => mergeParticipants(showMergeModal.id),
                                    disabled: mergeSelection.length < 2 || !newMergedName,
                                    className: "flex-1 bg-yellow-600 text-white py-3 rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed"
                                }, "ðŸ”— Fusionner"),
                                React.createElement('button', {
                                    onClick: () => {
                                        setShowMergeModal(null);
                                        setMergeSelection([]);
                                        setNewMergedName('');
                                    },
                                    className: "px-6 py-3 border-2 rounded-lg font-semibold"
                                }, "Annuler")
                            )
                        )
                    )
                )
            );
        }

        ReactDOM.render(
            React.createElement(VootersBreakAdmin),
            document.getElementById('root')
        );
    </script>
</body>
</html>
